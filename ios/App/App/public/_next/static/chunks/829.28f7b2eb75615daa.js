"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[829],{9678:(e,t,o)=>{o.d(t,{n:()=>i,x:()=>l});var n=o(5155),r=o(2115);let a=(0,r.createContext)(void 0);function i(e){let{children:t}=e,[o,i]=(0,r.useState)(!1),[l,s]=(0,r.useState)(!1);return(0,n.jsx)(a.Provider,{value:{isPremium:o,showPaywall:l,setShowPaywall:s,upgradeToPremium:()=>{console.log("Upgrade to premium triggered"),i(!0),s(!1)}},children:t})}function l(){let e=(0,r.useContext)(a);if(void 0===e)throw Error("usePremium must be used within a PremiumProvider");return e}},9829:(e,t,o)=>{o.r(t),o.d(t,{default:()=>u});var n=o(5155),r=o(2115),a=o(8045),i=o(6938),l=o(6913),s=o(3394),d=o(9500),c=o(9678);a.EA.workerSrc="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/".concat(a.rE,"/pdf.worker.min.mjs");let g={FW9:{"topmostSubform[0].Page1[0].f1_11[0]":3,"topmostSubform[0].Page1[0].f1_12[0]":2,"topmostSubform[0].Page1[0].f1_13[0]":4,"topmostSubform[0].Page1[0].f1_14[0]":2,"topmostSubform[0].Page1[0].f1_15[0]":7}};function u(e){let{file:t,onReset:o}=e,{setShowPaywall:u}=(0,c.x)(),[h,p]=(0,r.useState)(0),[x,f]=(0,r.useState)(1),[m,b]=(0,r.useState)([]),[y,w]=(0,r.useState)("select"),[v,k]=(0,r.useState)(null),[C,N]=(0,r.useState)(!1),[j,S]=(0,r.useState)(null),[F,D]=(0,r.useState)(16),[T,P]=(0,r.useState)("#000000"),[E,I]=(0,r.useState)([]),[z,L]=(0,r.useState)(!1),[R,M]=(0,r.useState)(null),[A,B]=(0,r.useState)(!1),[O,W]=(0,r.useState)(2),[Y,X]=(0,r.useState)([]),[U,H]=(0,r.useState)(!1),[_,V]=(0,r.useState)(!1),[G,q]=(0,r.useState)(1),[J,$]=(0,r.useState)(1),[K,Q]=(0,r.useState)({x:0,y:0}),[Z,ee]=(0,r.useState)(!1),[et,eo]=(0,r.useState)(0),[en,er]=(0,r.useState)(null),[ea,ei]=(0,r.useState)({x:0,y:0}),[el,es]=(0,r.useState)(null),[ed,ec]=(0,r.useState)(null),[eg,eu]=(0,r.useState)(null),[eh,ep]=(0,r.useState)(null),[ex,ef]=(0,r.useState)(new Set),[em,eb]=(0,r.useState)(!1),[ey,ew]=(0,r.useState)(""),ev=(0,r.useRef)(null),ek=(0,r.useRef)(null),eC=(0,r.useRef)(null),eN=(0,r.useRef)(!1);(0,r.useEffect)(()=>{console.log("Annotations updated:",m)},[m]),(0,r.useEffect)(()=>{let e=eC.current;if(!e)return;let t={x:0,y:0},o=!1,n=e=>{let t=e[0].clientX-e[1].clientX,o=e[0].clientY-e[1].clientY;return Math.sqrt(t*t+o*o)},r=e=>{let r=e.target,a="INPUT"===r.tagName||"TEXTAREA"===r.tagName||"BUTTON"===r.tagName||r.closest("[data-signature]")||r.closest("[data-annotation]");2===e.touches.length?(ee(!0),o=!1,eo(n(e.touches)),a||e.preventDefault()):1===e.touches.length&&J>1&&!a&&(o=!0,t={x:e.touches[0].clientX,y:e.touches[0].clientY})},a=e=>{let r=e.target,a="INPUT"===r.tagName||"TEXTAREA"===r.tagName||r.closest("[data-signature]")||r.closest("[data-annotation]");if(2===e.touches.length&&Z){let t=n(e.touches),o=.005*(t-et);$(e=>Math.max(.5,Math.min(3,e+o))),eo(t),a||e.preventDefault()}else if(1===e.touches.length&&o&&J>1&&!a){let o=e.touches[0].clientX-t.x,n=e.touches[0].clientY-t.y;Q(e=>({x:e.x+o,y:e.y+n})),t={x:e.touches[0].clientX,y:e.touches[0].clientY},e.preventDefault()}},i=()=>{ee(!1),o=!1,eo(0)};return e.addEventListener("touchstart",r,{passive:!1}),e.addEventListener("touchmove",a,{passive:!1}),e.addEventListener("touchend",i),e.addEventListener("touchcancel",i),()=>{e.removeEventListener("touchstart",r),e.removeEventListener("touchmove",a),e.removeEventListener("touchend",i),e.removeEventListener("touchcancel",i)}},[Z,et,J]),(0,r.useEffect)(()=>{let e=(e,t)=>{if(en&&eC.current){let o=eC.current.getBoundingClientRect(),n=(e-o.left-ea.x)/G,r=(t-o.top-ea.y)/G;b(e=>e.map(e=>e.id===en?{...e,x:n,y:r}:e))}else if(el&&eg){let o=e-eg.x,n=t-eg.y,r=Math.max(50,eg.width+o)/G,a=Math.max(30,eg.height+n)/G;b(e=>e.map(e=>e.id===el?{...e,width:r,height:a}:e))}},t=t=>{e(t.clientX,t.clientY)},o=t=>{if(1===t.touches.length){let o=t.touches[0];e(o.clientX,o.clientY),t.preventDefault()}},n=()=>{(en||el)&&(eN.current=!0,setTimeout(()=>{eN.current=!1},100)),er(null),es(null),eu(null)};if(en||el)return document.addEventListener("mousemove",t),document.addEventListener("mouseup",n),document.addEventListener("touchmove",o,{passive:!1}),document.addEventListener("touchend",n),()=>{document.removeEventListener("mousemove",t),document.removeEventListener("mouseup",n),document.removeEventListener("touchmove",o),document.removeEventListener("touchend",n)}},[en,el,ea,eg,G]),(0,r.useEffect)(()=>{if(C&&ev.current){let e=ev.current,t=e.getContext("2d");t&&(t.fillStyle="white",t.fillRect(0,0,e.width,e.height)),ek.current=new d.A(e,{backgroundColor:"rgb(255, 255, 255)"})}},[C]);let ej=async e=>{let{numPages:t}=e;try{p(t);let e=await eS();0===e.length&&(console.log("No AcroForm fields found, trying pdf.js annotation detection..."),await eF()),L(!0)}catch(e){console.error("Error loading PDF:",e),alert("There was an error loading your PDF. Please try a different file or go back and try again.")}},eS=async()=>{console.log("=== STARTING FORM FIELD EXTRACTION ===");try{let e=await t.arrayBuffer();console.log("PDF loaded, size:",e.byteLength,"bytes");let o=await s.PDFDocument.load(e);console.log("PDFDocument loaded");let n=o.getForm();console.log("Form object:",n);let r=n.getFields();console.log("Total fields found:",r.length);let a=[];for(let e of r){let t=e.getName();console.log("Processing field:",t);let r="",i="unknown";try{let l=e.constructor.name;if(console.log("  Field type:",l),"PDFTextField"===l)r=n.getTextField(t).getText()||"",i="text";else if("PDFCheckBox"===l)r=n.getCheckBox(t).isChecked()?"Yes":"No",i="checkbox";else if("PDFDropdown"===l){let e=n.getDropdown(t).getSelected();r=e?e.join(", "):"",i="dropdown"}else"PDFRadioGroup"===l&&(r=n.getRadioGroup(t).getSelected()||"",i="radio");let s=e.acroField.getWidgets();if(console.log("  Widgets found:",(null==s?void 0:s.length)||0),s&&s.length>0){let e=s[0],n=e.getRectangle(),l=-1,d=o.getPages(),c=e.P();for(let e=0;e<d.length;e++)if(d[e].ref===c){l=e;break}if(-1===l&&(l=d.indexOf(c)),-1===l)for(let e=0;e<d.length;e++){let t=d[e].node;if(t===c||t.dict===c){l=e;break}}-1===l&&(console.log("  ⚠️ Could not determine page, defaulting to page 1"),l=0),console.log("  Rectangle:",n),console.log("  Page index:",l),n?(a.push({name:t,value:r,type:i,rect:[n.x,n.y,n.width,n.height],pageNumber:l+1}),console.log("  ✓ Field extracted successfully")):console.log("  ✗ No rectangle found")}else console.log("  ✗ No widgets found")}catch(e){console.warn("Could not extract field ".concat(t,":"),e)}}return console.log("=== EXTRACTION COMPLETE ==="),console.log("Total fields extracted:",a.length),console.log("Extracted form fields:",a),I(a),a.length>0?(console.log("Converting fields to annotations..."),await eT(a)):console.log("⚠️ No fields to convert - PDF may not have form fields"),a}catch(e){return console.error("❌ Error extracting form fields:",e),[]}},eF=async()=>{console.log("=== EXTRACTING ANNOTATIONS WITH PDF.JS ===");try{let e=a.YE(await t.arrayBuffer()),o=await e.promise;console.log("PDF loaded, total pages:",o.numPages);let n=[];for(let e=1;e<=o.numPages;e++){let t=await o.getPage(e),r=await t.getAnnotations();for(let o of(console.log("Page ".concat(e,": Found ").concat(r.length," annotations")),r))if(console.log("Annotation:",o),"Widget"===o.subtype&&o.fieldType){let r=o.rect,a=r[0];r[1];let i=r[2]-r[0],l=r[3]-r[1],s=t.getViewport({scale:1}).height-r[3];console.log("  Widget field:",{fieldName:o.fieldName,fieldType:o.fieldType,rect:r,converted:{x:a,y:s,width:i,height:l}}),"Tx"===o.fieldType?n.push({id:"pdfjs-field-".concat(o.fieldName||o.id,"-").concat(Date.now()),type:"formfield",x:a,y:s,width:i,height:l,pageNumber:e,text:o.fieldValue||"",fieldName:o.fieldName||"field-".concat(o.id),isFormField:!0,fieldType:"text",fontSize:Math.min(12,.7*l),textColor:"#000000"}):"Btn"===o.fieldType&&n.push({id:"pdfjs-checkbox-".concat(o.fieldName||o.id,"-").concat(Date.now()),type:"formfield",x:a,y:s,width:i,height:l,pageNumber:e,text:o.buttonValue?"☑":"☐",fieldName:o.fieldName||"checkbox-".concat(o.id),isFormField:!0,fieldType:"checkbox",isChecked:"Yes"===o.buttonValue||!0===o.buttonValue,fontSize:Math.min(16,.8*l),textColor:"#000000"})}}console.log("=== PDF.JS EXTRACTION COMPLETE ==="),console.log("Total annotations found:",n.length),n.length>0?(b(n),console.log("Annotations set from pdf.js detection")):console.log("⚠️ No widget annotations found with pdf.js either")}catch(e){console.error("❌ Error extracting annotations with pdf.js:",e)}},eD=async e=>{try{let o=a.YE(await t.arrayBuffer()),n=await o.promise,r=await n.getPage(e),i=await r.getOperatorList(),l=[];for(let e=0;e<i.fnArray.length;e++){let t=i.fnArray[e],o=i.argsArray[e];if(43===t&&o&&o.length>=4){let[e,t,n,r]=o;l.push({x:e,y:t,width:n,height:r})}}return l}catch(e){return console.error("Error extracting visual boxes:",e),[]}},eT=async e=>{console.log("=== CONVERTING FORM FIELDS TO ANNOTATIONS ==="),console.log("Fields to convert:",e.length);try{let o=await t.arrayBuffer(),n=(await s.PDFDocument.load(o)).getPages();console.log("Total pages:",n.length);let r=[],a=e.map(e=>e.name).some(e=>e.includes("topmostSubform")&&e.includes("Page1"))?(console.log("\uD83D\uDCCB Detected form type: FW9"),"FW9"):(console.log("\uD83D\uDCCB Form type not recognized - using generic handling"),null),i=a?g[a]:{},l=new Map;for(let t of e){let[e,o,a,s]=t.rect,d=t.pageNumber-1;if(console.log('Converting field "'.concat(t.name,'":'),{type:t.type,rect:t.rect,pageNumber:t.pageNumber,pageIndex:d}),d>=0&&d<n.length){let c=n[d].getSize().height,g=c-o-s;if(s>20||a<2*s||(g-=.5*s),"text"===t.type){let n=0;if(i[t.name]?(n=i[t.name],console.log("  ✓ Using configured split: ".concat(n," boxes for field: ").concat(t.name))):a>1.5*s?console.log("  No config for field: ".concat(t.name,", checking heuristics...")):console.log("  Field ".concat(t.name," too narrow for splitting (width:").concat(a," height:").concat(s,")")),0===n&&a>1.5*s){if(!l.has(t.pageNumber)){console.log("  Extracting visual boxes from page ".concat(t.pageNumber,"..."));let e=await eD(t.pageNumber);l.set(t.pageNumber,e),console.log("  Found ".concat(e.length," visual rectangles on page"))}let n=(l.get(t.pageNumber)||[]).filter(t=>{let n=t.x>=e-5&&t.x+t.width<=e+a+5&&t.y>=o-5&&t.y+t.height<=o+s+5,r=t.width>5&&t.width<50&&t.height>5&&t.height<50;return n&&r});if(n.sort((e,t)=>e.x-t.x),n.length>=2){console.log("  ✓ Using ".concat(n.length," detected visual boxes"));for(let e=0;e<n.length;e++){let o=n[e],a=c-o.y-o.height;o.height>20||o.width<2*o.height||(a-=.5*o.height);let i={id:"formfield-".concat(t.name,"-box").concat(e,"-").concat(Date.now()),type:"formfield",x:o.x,y:a,width:o.width,height:o.height,pageNumber:t.pageNumber,text:"",fieldName:"".concat(t.name,"_digit").concat(e),isFormField:!0,fieldType:"text",isChecked:!1,fontSize:Math.min(12,.7*o.height),textColor:"#000000"};r.push(i)}continue}}if(n>=2){let o=a/n,i=.05*o,l=o-i;console.log("  Creating ".concat(n," evenly-spaced boxes"));for(let a=0;a<n;a++){let n=e+a*o,i={id:"formfield-".concat(t.name,"-box").concat(a,"-").concat(Date.now()),type:"formfield",x:n,y:g,width:l,height:s,pageNumber:t.pageNumber,text:"",fieldName:"".concat(t.name,"_digit").concat(a),isFormField:!0,fieldType:"text",isChecked:!1,fontSize:Math.min(12,.7*s),textColor:"#000000",groupId:t.name,groupIndex:a};r.push(i)}}else{let o={id:"formfield-".concat(t.name,"-").concat(Date.now()),type:"formfield",x:e,y:g,width:a,height:s,pageNumber:t.pageNumber,text:"",fieldName:t.name,isFormField:!0,fieldType:"text",isChecked:!1,fontSize:Math.min(12,.7*s),textColor:"#000000"};console.log("  Created single annotation:",o),r.push(o)}}else{let o={id:"formfield-".concat(t.name,"-").concat(Date.now()),type:"formfield",x:e,y:g,width:a,height:s,pageNumber:t.pageNumber,text:"checkbox"===t.type?"Yes"===t.value?"☑":"☐":"",fieldName:t.name,isFormField:!0,fieldType:t.type,isChecked:"checkbox"===t.type&&"Yes"===t.value,fontSize:Math.min(12,.7*s),textColor:"#000000"};console.log("  Created annotation:",o),r.push(o)}}else console.warn("Page ".concat(t.pageNumber," not found for field ").concat(t.name))}console.log("=== CONVERSION COMPLETE ==="),console.log("Total annotations created:",r.length),console.log("Annotations:",r),b(r),console.log("Annotations state updated")}catch(e){console.error("❌ Error converting form fields:",e)}},eP=(e,t)=>{b(o=>o.map(o=>o.id===e?{...o,text:t}:o))},eE=async()=>{try{console.log("=== DOWNLOAD STARTED ==="),console.log("Total annotations: ".concat(m.length));let n=await t.arrayBuffer(),r=await s.PDFDocument.load(n),a=r.getPages(),i=r.getForm(),l=new Map;for(let e of m)"formfield"===e.type&&console.log("Formfield: ".concat(e.fieldName,", has groupId: ").concat(!!e.groupId,", groupIndex: ").concat(e.groupIndex,', text: "').concat(e.text,'"')),"formfield"===e.type&&e.groupId&&void 0!==e.groupIndex&&(console.log("  ✓ Found grouped field: groupId=".concat(e.groupId,", index=").concat(e.groupIndex,', text="').concat(e.text,'"')),l.has(e.groupId)||l.set(e.groupId,{fieldName:e.groupId,digits:[]}),l.get(e.groupId).digits[e.groupIndex]=e.text||"");for(let[e,t]of(console.log("Total grouped fields found: ".concat(l.size)),l))try{let o=t.digits.join("");console.log("Setting grouped field ".concat(e,' to: "').concat(o,'"'));let n=i.getFieldMaybe(e);if(n&&"PDFTextField"===n.constructor.name){let t=i.getTextField(e);t.setText(o),t.enableReadOnly(),console.log("  ✓ Successfully set ".concat(e))}else console.warn("  ✗ Field ".concat(e," not found or not a text field"))}catch(t){console.warn("Could not update grouped field ".concat(e,":"),t)}for(let e of m)if("formfield"===e.type&&e.fieldName&&e.isFormField&&!e.groupId)try{let t=i.getFieldMaybe(e.fieldName);if(t){let o=t.constructor.name;if("PDFTextField"===o){let t=i.getTextField(e.fieldName);t.setText(e.text||""),t.enableReadOnly()}else if("PDFCheckBox"===o){let t=i.getCheckBox(e.fieldName);e.isChecked?t.check():t.uncheck()}}}catch(t){console.warn("Could not update field ".concat(e.fieldName,":"),t)}for(let t of m){var e,o;let n=a[t.pageNumber-1];if(!n)continue;let{height:i}=n.getSize();if("formfield"!==t.type||!t.isFormField){if("eraser"===t.type)n.drawRectangle({x:t.x,y:i-t.y-t.height,width:t.width,height:t.height,color:(0,s.rgb)(1,1,1)});else if("formfield"===t.type&&!1===t.isFormField){if(n.drawRectangle({x:t.x,y:i-t.y-t.height,width:t.width,height:t.height,color:(0,s.rgb)(1,1,1)}),t.text){let o=t.fontSize||12,r=null==(e=t.textColor)?void 0:e.match(/^#([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})$/i),a=r?(0,s.rgb)(parseInt(r[1],16)/255,parseInt(r[2],16)/255,parseInt(r[3],16)/255):(0,s.rgb)(0,0,0);try{n.drawText(t.text,{x:t.x,y:i-t.y-t.height+2,size:o,color:a})}catch(e){console.warn("Could not draw text:",e)}}}else if("text"===t.type&&t.text){let e=t.fontSize||16,r=null==(o=t.textColor)?void 0:o.match(/^#([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})$/i),a=r?(0,s.rgb)(parseInt(r[1],16)/255,parseInt(r[2],16)/255,parseInt(r[3],16)/255):(0,s.rgb)(0,0,0);n.drawText(t.text,{x:t.x,y:i-t.y-e-5,size:e,color:a})}else if("signature"===t.type&&t.imageData){let e=Uint8Array.from(atob(t.imageData.split(",")[1]),e=>e.charCodeAt(0)),o=await r.embedPng(e);n.drawImage(o,{x:t.x,y:i-t.y-t.height,width:t.width,height:t.height})}}}let d=await r.save(),c=new Blob([d],{type:"application/pdf"}),g=URL.createObjectURL(c),u=document.createElement("a");if(u.href=g,ey)u.download=ey;else{let e=t.name.split("."),o=e.pop(),n=e.join(".");u.download="".concat(n,"-edited.").concat(o)}u.click(),URL.revokeObjectURL(g),eb(!1)}catch(e){console.error("Error generating PDF:",e),alert("Error generating PDF. Please try again.")}};return(0,n.jsxs)("div",{className:"flex mobile-viewport flex-col",children:[(0,n.jsxs)("div",{className:"safe-area-top bg-white border-b border-gray-200 px-3 sm:px-6 py-3 sm:py-4 flex gap-2 sm:gap-4 items-center flex-wrap shadow-sm sticky top-0 z-40",children:[o&&(0,n.jsxs)("button",{onClick:o,className:"px-3 py-2.5 bg-gray-50 text-gray-700 rounded-xl hover:bg-gray-100 border border-gray-200 transition-all duration-200 flex items-center gap-2",title:"Back to home",children:[(0,n.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10 19l-7-7m0 0l7-7m-7 7h18"})}),(0,n.jsx)("span",{className:"hidden sm:inline text-sm font-semibold",children:"Back"})]}),(0,n.jsx)("button",{onClick:()=>w("text"),className:"px-3 sm:px-5 py-2.5 text-xs sm:text-sm font-semibold rounded-xl transition-all duration-200 ".concat("text"===y?"bg-gradient-to-r from-indigo-600 to-purple-600 text-white shadow-lg shadow-indigo-500/30 hover:shadow-xl hover:shadow-indigo-500/40":"bg-gray-50 text-gray-700 hover:bg-gray-100 border border-gray-200"),children:(0,n.jsxs)("span",{className:"inline-flex items-center gap-1 sm:gap-2",children:[(0,n.jsx)("svg",{className:"w-4 h-4 sm:w-5 sm:h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})}),(0,n.jsx)("span",{className:"hidden sm:inline",children:"Add Text"}),(0,n.jsx)("span",{className:"sm:hidden",children:"Text"})]})}),(0,n.jsx)("button",{onClick:()=>w("signature"),className:"px-3 sm:px-5 py-2.5 text-xs sm:text-sm font-semibold rounded-xl transition-all duration-200 ".concat("signature"===y?"bg-gradient-to-r from-indigo-600 to-purple-600 text-white shadow-lg shadow-indigo-500/30 hover:shadow-xl hover:shadow-indigo-500/40":"bg-gray-50 text-gray-700 hover:bg-gray-100 border border-gray-200"),children:(0,n.jsxs)("span",{className:"inline-flex items-center gap-1 sm:gap-2",children:[(0,n.jsx)("svg",{className:"w-4 h-4 sm:w-5 sm:h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"})}),(0,n.jsx)("span",{className:"hidden sm:inline",children:"Add Signature"}),(0,n.jsx)("span",{className:"sm:hidden",children:"Sign"})]})}),(0,n.jsx)("button",{onClick:()=>u(!0),className:"hidden sm:block relative px-4 sm:px-6 py-2.5 bg-white border-2 border-purple-200 text-purple-700 rounded-xl hover:bg-purple-50 hover:border-purple-300 text-xs sm:text-sm font-semibold shadow-sm hover:shadow-md transition-all duration-200",children:(0,n.jsxs)("span",{className:"inline-flex items-center gap-2",children:[(0,n.jsx)("svg",{className:"w-4 h-4 sm:w-5 sm:h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"})}),(0,n.jsx)("span",{className:"hidden sm:inline",children:"Send for Signature"}),(0,n.jsx)("span",{className:"absolute -top-1 -right-1 px-1.5 py-0.5 bg-gradient-to-r from-amber-400 to-orange-500 text-white text-xs font-bold rounded-full",children:"PRO"})]})}),(0,n.jsx)("div",{className:"flex-1"}),(0,n.jsx)("button",{onClick:()=>{let e=t.name.split("."),o=e.pop(),n=e.join(".");ew("".concat(n,"-edited.").concat(o)),eb(!0)},className:"px-3 sm:px-6 py-2.5 bg-gradient-to-r from-indigo-600 to-purple-600 text-white rounded-xl hover:from-indigo-700 hover:to-purple-700 text-xs sm:text-sm font-semibold shadow-lg shadow-indigo-500/30 hover:shadow-xl hover:shadow-indigo-500/40 transition-all duration-200",children:(0,n.jsxs)("span",{className:"inline-flex items-center gap-1 sm:gap-2",children:[(0,n.jsx)("svg",{className:"w-4 h-4 sm:w-5 sm:h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})}),(0,n.jsx)("span",{className:"hidden sm:inline",children:"Download"}),(0,n.jsx)("span",{className:"sm:hidden",children:"Save"})]})})]}),(0,n.jsxs)("div",{className:"flex-1 overflow-auto bg-gray-200 p-3 sm:p-8 safe-area-bottom",children:[(0,n.jsxs)("div",{ref:eC,className:"relative bg-white shadow-2xl mx-auto w-fit",onClick:e=>{if(en||el||eN.current)return;let t=e.currentTarget.getBoundingClientRect(),o=e.clientX-t.left,n=e.clientY-t.top;if("text"===y){let e={id:Date.now().toString(),type:"text",x:o,y:n,width:200,height:30,pageNumber:x,text:"",fontSize:14,textColor:"#000000"};b(t=>[...t,e]),w("select")}else"signature"===y?(S({x:o,y:n}),N(!0)):(k(null),ep(null))},style:{cursor:"signature"===y||"text"===y?"crosshair":"default",transform:"translate(".concat(K.x,"px, ").concat(K.y,"px) scale(").concat(J,")"),transformOrigin:"center center",transition:Z?"none":"transform 0.2s ease-out",touchAction:"none"},children:[(0,n.jsx)(i.A,{file:t,onLoadSuccess:ej,onLoadError:e=>{console.error("PDF load error:",e),alert("Failed to load PDF. The file may be corrupted or incompatible. Please try another file."),o&&o()},loading:(0,n.jsx)("div",{className:"flex items-center justify-center p-20",children:(0,n.jsxs)("div",{className:"text-center",children:[(0,n.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600 mx-auto mb-4"}),(0,n.jsx)("p",{className:"text-gray-600",children:"Loading PDF..."})]})}),children:(0,n.jsx)(l.A,{pageNumber:x,width:Math.min(window.innerWidth-48,800),renderTextLayer:!1,renderAnnotationLayer:!1,onRenderSuccess:e=>{console.log("Page rendered:",e);let t=e.width/e.originalWidth;console.log("Calculated scale:",t),q(t)}})}),m.filter(e=>e.pageNumber===x).map(e=>(0,n.jsxs)("div",{style:{position:"absolute",left:"checkbox"===e.fieldType?e.x*G-6:e.x*G,top:"checkbox"===e.fieldType?e.y*G-6:e.y*G,width:"checkbox"===e.fieldType?Math.max(e.width*G,24):e.width*G,height:"checkbox"===e.fieldType?Math.max(e.height*G,24):e.height*G,padding:"0",pointerEvents:"auto",zIndex:1e3},children:["formfield"===e.type&&e.isFormField&&"text"===e.fieldType&&(0,n.jsx)("input",{type:"text",value:e.text||"",onChange:t=>{let o=t.target.value;if(eP(e.id,o),e.groupId&&void 0!==e.groupIndex&&1===o.length){let t=m.find(t=>t.groupId===e.groupId&&t.groupIndex===e.groupIndex+1);t&&setTimeout(()=>{let e=document.querySelector('input[data-field-id="'.concat(t.id,'"]'));e&&(e.focus(),e.select())},0)}},onClick:e=>{e.stopPropagation()},onMouseDown:e=>{e.stopPropagation()},"data-field-id":e.id,onFocus:e=>{e.target.style.backgroundColor="rgba(255, 255, 255, 0.98)",e.target.style.border="2px solid rgba(99, 102, 241, 0.8)"},onBlur:e=>{e.target.style.backgroundColor="transparent",e.target.style.border="1px solid rgba(99, 102, 241, 0.3)"},style:{width:"100%",height:"100%",border:"2px solid rgba(99, 102, 241, 0.4)",outline:"none",backgroundColor:"rgba(99, 102, 241, 0.05)",fontSize:"".concat(Math.min((e.fontSize||12)*G,e.height*G*.55),"px"),color:"#000000",fontWeight:e.groupId?"600":"normal",padding:e.groupId?"2px 1px":"1px 3px",boxSizing:"border-box",fontFamily:"system-ui, -apple-system, sans-serif",transition:"all 0.15s ease",cursor:"text",pointerEvents:"auto",zIndex:1001,position:"relative",borderRadius:"2px",overflow:"visible",textOverflow:"clip",whiteSpace:"nowrap",lineHeight:"".concat(e.height*G-4,"px"),textAlign:e.width<40?"center":"left"},placeholder:"",autoComplete:"off",tabIndex:0,maxLength:e.width<40?1:void 0}),"formfield"===e.type&&e.isFormField&&"checkbox"===e.fieldType&&(0,n.jsx)("div",{onClick:t=>{t.stopPropagation(),t.preventDefault(),console.log("\uD83D\uDDB1️ Checkbox clicked:",e.id,"Was:",e.isChecked),b(t=>t.map(t=>t.id===e.id?{...t,isChecked:!t.isChecked,text:t.isChecked?"☐":"☑"}:t)),console.log("\uD83D\uDDB1️ Now should be:",!e.isChecked)},onMouseDown:e=>{e.stopPropagation(),e.preventDefault()},tabIndex:0,role:"checkbox","aria-checked":e.isChecked,style:{width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",pointerEvents:"auto",zIndex:1e4,fontSize:"16px",fontWeight:"bold",color:"#000000",userSelect:"none",backgroundColor:"transparent",border:"none",boxSizing:"border-box"},title:e.isChecked?"Checked - Click to uncheck":"Unchecked - Click to check",children:e.isChecked?"✓":""}),"formfield"===e.type&&e.isFormField&&!e.fieldType&&(0,n.jsx)("input",{type:"text",value:e.text||"",onChange:t=>{eP(e.id,t.target.value)},onClick:e=>{e.stopPropagation()},onMouseDown:e=>{e.stopPropagation()},onFocus:e=>{e.target.style.backgroundColor="rgba(255, 255, 255, 0.98)",e.target.style.border="2px solid rgba(99, 102, 241, 0.8)"},onBlur:e=>{e.target.style.backgroundColor="transparent",e.target.style.border="1px solid rgba(99, 102, 241, 0.3)"},style:{width:"100%",height:"100%",border:"1px solid rgba(99, 102, 241, 0.3)",outline:"none",backgroundColor:"transparent",fontSize:"".concat(Math.min((e.fontSize||12)*G,e.height*G*.6),"px"),color:e.textColor||"#000",padding:"1px 3px",boxSizing:"border-box",fontFamily:"system-ui, -apple-system, sans-serif",transition:"all 0.15s ease",cursor:"text",pointerEvents:"auto",zIndex:1001,position:"relative",borderRadius:"2px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",lineHeight:"".concat(e.height*G-4,"px"),textAlign:e.width<40?"center":"left"},placeholder:"",autoComplete:"off",tabIndex:0,maxLength:e.width<40?1:void 0}),"text"===e.type&&!e.isFormField&&(0,n.jsxs)("div",{style:{width:"100%",height:"100%",position:"relative",border:v===e.id?"2px solid #6366f1":"none",borderRadius:"3px",backgroundColor:v===e.id?"rgba(255, 255, 255, 0.95)":"transparent",padding:"4px",boxSizing:"border-box",cursor:v===e.id?"move":"default"},onMouseDown:t=>{if(t.target!==t.currentTarget.querySelector("input")&&(t.stopPropagation(),eC.current)){let o=t.currentTarget.getBoundingClientRect();er(e.id),k(e.id),ei({x:t.clientX-o.left,y:t.clientY-o.top})}},onClick:t=>{t.stopPropagation(),k(e.id)},children:[(0,n.jsx)("input",{type:"text",value:e.text||"",onChange:t=>{eP(e.id,t.target.value)},onClick:t=>{t.stopPropagation(),k(e.id)},onMouseDown:e=>{e.stopPropagation()},onFocus:t=>{t.target.parentElement.style.backgroundColor="rgba(255, 255, 255, 0.98)",t.target.parentElement.style.border="2px solid rgba(99, 102, 241, 0.8)",k(e.id)},onBlur:t=>{t.target.parentElement.style.backgroundColor="rgba(255, 255, 255, 0.8)",t.target.parentElement.style.border=v===e.id?"2px solid #6366f1":"1px solid rgba(99, 102, 241, 0.5)"},style:{width:"100%",height:"100%",border:"none",outline:"none",backgroundColor:"transparent",fontSize:"".concat(Math.min((e.fontSize||14)*G,e.height*G*.6),"px"),color:e.textColor||"#000",padding:"2px 4px",boxSizing:"border-box",fontFamily:"system-ui, -apple-system, sans-serif",cursor:"text",pointerEvents:"auto",zIndex:1001},placeholder:"Type here...",autoComplete:"off",tabIndex:0}),v===e.id&&(0,n.jsx)("div",{style:{position:"absolute",right:-6,bottom:-6,width:16,height:16,backgroundColor:"#6366f1",border:"2px solid white",borderRadius:"50%",cursor:"nwse-resize",pointerEvents:"auto",zIndex:10,boxShadow:"0 2px 4px rgba(0,0,0,0.2)"},onMouseDown:t=>{t.stopPropagation(),es(e.id),k(e.id),eu({x:t.clientX,y:t.clientY,width:e.width*G,height:e.height*G})}}),v===e.id&&!en&&!el&&(0,n.jsx)("button",{onMouseDown:e=>{e.stopPropagation()},onClick:t=>{t.stopPropagation(),t.preventDefault(),b(t=>t.filter(t=>t.id!==e.id)),k(null)},style:{position:"absolute",top:-40,right:0,padding:"8px 16px",backgroundColor:"#ef4444",color:"white",border:"none",borderRadius:"8px",fontSize:"13px",fontWeight:"600",cursor:"pointer",boxShadow:"0 4px 6px rgba(0,0,0,0.1)",whiteSpace:"nowrap",zIndex:1e4,pointerEvents:"auto"},children:"\uD83D\uDDD1️ Delete"})]}),"signature"===e.type&&e.imageData&&(0,n.jsxs)("div",{"data-signature":"true",onClick:t=>{ex.has(e.id)||(t.stopPropagation(),ep(e.id))},onMouseDown:t=>{if(!ex.has(e.id)){t.stopPropagation();let o=t.currentTarget.getBoundingClientRect();er(e.id),ep(e.id),ei({x:t.clientX-o.left,y:t.clientY-o.top})}},onTouchStart:t=>{if(!ex.has(e.id)){t.stopPropagation();let o=t.touches[0],n=t.currentTarget.getBoundingClientRect();er(e.id),ep(e.id),ei({x:o.clientX-n.left,y:o.clientY-n.top})}},style:{width:"100%",height:"100%",position:"relative",cursor:ex.has(e.id)?"default":en===e.id?"grabbing":"grab",pointerEvents:"auto",border:ex.has(e.id)?"none":en===e.id||el===e.id||eh===e.id?"2px solid #6366f1":"1px dashed rgba(99, 102, 241, 0.3)"},children:[(0,n.jsx)("img",{src:e.imageData,alt:"Signature",style:{width:"100%",height:"100%",objectFit:"contain",pointerEvents:"none",backgroundColor:"transparent"},draggable:!1}),!ex.has(e.id)&&(0,n.jsx)("div",{"data-signature":"true",style:{position:"absolute",right:-6,bottom:-6,width:16,height:16,backgroundColor:"#6366f1",border:"2px solid white",borderRadius:"50%",cursor:"nwse-resize",pointerEvents:"auto",zIndex:10,boxShadow:"0 2px 4px rgba(0,0,0,0.2)"},onMouseDown:t=>{t.stopPropagation(),es(e.id),ep(e.id),eu({x:t.clientX,y:t.clientY,width:e.width*G,height:e.height*G})},onTouchStart:t=>{t.stopPropagation();let o=t.touches[0];es(e.id),ep(e.id),eu({x:o.clientX,y:o.clientY,width:e.width*G,height:e.height*G})}}),eh===e.id&&!ex.has(e.id)&&!en&&!el&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("button",{onMouseDown:e=>{e.stopPropagation()},onClick:t=>{t.stopPropagation(),t.preventDefault(),console.log("\uD83D\uDDD1️ Delete button clicked - Removing signature!"),b(t=>t.filter(t=>t.id!==e.id)),ep(null)},title:"Delete signature",style:{position:"absolute",top:-22,right:22,width:18,height:18,backgroundColor:"white",color:"#000",border:"1px solid #999",borderRadius:"50%",fontSize:"11px",fontWeight:"bold",cursor:"pointer",boxShadow:"0 2px 4px rgba(0,0,0,0.15)",zIndex:1e4,pointerEvents:"auto",display:"flex",alignItems:"center",justifyContent:"center",transition:"all 0.2s",filter:"contrast(1.2)"},onMouseEnter:e=>{e.currentTarget.style.transform="scale(1.15)",e.currentTarget.style.boxShadow="0 3px 6px rgba(0,0,0,0.25)"},onMouseLeave:e=>{e.currentTarget.style.transform="scale(1)",e.currentTarget.style.boxShadow="0 2px 4px rgba(0,0,0,0.15)"},children:"\uD83D\uDDD1️"}),(0,n.jsx)("button",{onMouseDown:e=>{e.stopPropagation()},onClick:t=>{t.stopPropagation(),t.preventDefault(),console.log("\uD83D\uDDB1️ Confirm button clicked - Signature locked!"),ef(t=>new Set([...t,e.id])),ep(null)},title:"Confirm signature",style:{position:"absolute",top:-22,right:2,width:18,height:18,backgroundColor:"white",color:"#000",border:"1px solid #999",borderRadius:"50%",fontSize:"11px",fontWeight:"bold",cursor:"pointer",boxShadow:"0 2px 4px rgba(0,0,0,0.15)",zIndex:1e4,pointerEvents:"auto",display:"flex",alignItems:"center",justifyContent:"center",transition:"all 0.2s",filter:"contrast(1.2)"},onMouseEnter:e=>{e.currentTarget.style.transform="scale(1.15)",e.currentTarget.style.boxShadow="0 3px 6px rgba(0,0,0,0.25)"},onMouseLeave:e=>{e.currentTarget.style.transform="scale(1)",e.currentTarget.style.boxShadow="0 2px 4px rgba(0,0,0,0.15)"},children:"✓"})]})]})]},e.id))]}),E.length>0&&z&&(0,n.jsxs)("div",{style:{marginTop:"20px",padding:"16px",backgroundColor:"white",borderRadius:"12px",boxShadow:"0 2px 8px rgba(0,0,0,0.08)",border:"1px solid #e0e7ff"},children:[(0,n.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"8px",marginBottom:"12px"},children:[(0,n.jsx)("div",{style:{width:"32px",height:"32px",borderRadius:"8px",background:"linear-gradient(135deg, #6366f1 0%, #a855f7 100%)",display:"flex",alignItems:"center",justifyContent:"center"},children:(0,n.jsx)("span",{style:{fontSize:"16px"},children:"✓"})}),(0,n.jsx)("strong",{style:{fontSize:"15px",color:"#1e293b",fontWeight:"600"},children:"Form Fields Ready"})]}),(0,n.jsxs)("div",{style:{fontSize:"13px",color:"#64748b",marginBottom:"12px",lineHeight:"1.6"},children:[E.length," fillable field",E.length>1?"s":""," automatically detected. Just click and type!"]}),(0,n.jsxs)("div",{style:{fontSize:"12px",color:"#64748b",lineHeight:"1.8",padding:"12px",backgroundColor:"#f8fafc",borderRadius:"8px",border:"1px solid #e2e8f0"},children:[(0,n.jsx)("strong",{style:{color:"#475569",display:"block",marginBottom:"6px"},children:"How to use:"}),"• Click any highlighted field to type or edit",(0,n.jsx)("br",{}),'• Use "Add Signature" to draw and place your signature',(0,n.jsx)("br",{}),"• Drag and resize signatures, then click ✓ to confirm",(0,n.jsx)("br",{}),'• Click "Download PDF" to save your completed document']})]}),0===E.length&&!_&&(0,n.jsx)("div",{style:{marginTop:"20px",padding:"16px",backgroundColor:"white",borderRadius:"12px",boxShadow:"0 2px 8px rgba(0,0,0,0.08)",border:"1px solid #e2e8f0"},children:(0,n.jsxs)("div",{style:{fontSize:"13px",color:"#64748b",textAlign:"center",lineHeight:"1.6"},children:["No fillable form fields detected in this PDF.",(0,n.jsx)("br",{}),(0,n.jsx)("span",{style:{fontSize:"12px",color:"#94a3b8"},children:"Use the tools above to add text or signatures manually."})]})})]}),(0,n.jsxs)("div",{className:"bg-gradient-to-b from-gray-100 to-gray-200 border-t border-gray-300 p-3 flex items-center justify-center gap-3",children:[(0,n.jsx)("button",{onClick:()=>f(Math.max(1,x-1)),disabled:1===x,className:"px-5 py-2.5 bg-white text-gray-700 border border-gray-200 rounded-xl hover:bg-gray-50 hover:border-gray-300 disabled:opacity-40 disabled:cursor-not-allowed transition-all duration-200 shadow-sm hover:shadow font-medium text-sm",children:"← Previous"}),(0,n.jsxs)("span",{className:"text-sm font-medium text-gray-700 px-3",children:["Page ",x," of ",h]}),(0,n.jsx)("button",{onClick:()=>f(Math.min(h,x+1)),disabled:x===h,className:"px-5 py-2.5 bg-white text-gray-700 border border-gray-200 rounded-xl hover:bg-gray-50 hover:border-gray-300 disabled:opacity-40 disabled:cursor-not-allowed transition-all duration-200 shadow-sm hover:shadow font-medium text-sm",children:"Next →"})]}),C&&(0,n.jsx)("div",{className:"fixed inset-0 flex items-center justify-center",style:{zIndex:99999,backgroundColor:"rgba(0, 0, 0, 0.15)"},children:(0,n.jsxs)("div",{className:"bg-white rounded-lg p-4 w-full mx-4 shadow-2xl border border-gray-300",style:{maxWidth:"400px"},children:[(0,n.jsx)("h3",{className:"text-base font-semibold mb-2 text-gray-800",children:"Draw Your Signature"}),(0,n.jsx)("div",{className:"border-2 border-gray-300 rounded-lg overflow-hidden",children:(0,n.jsx)("canvas",{ref:ev,width:350,height:100,className:"w-full"})}),(0,n.jsxs)("div",{className:"flex gap-3 mt-4",children:[(0,n.jsx)("button",{onClick:()=>{var e;return null==(e=ek.current)?void 0:e.clear()},className:"px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300",children:"Clear"}),(0,n.jsx)("button",{onClick:()=>{N(!1),S(null)},className:"flex-1 px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300",children:"Cancel"}),(0,n.jsx)("button",{onClick:()=>{if(!ek.current||ek.current.isEmpty()||!j)return void alert("Please draw a signature first");let e=document.createElement("canvas"),t=ev.current;if(!t)return;e.width=t.width,e.height=t.height;let o=e.getContext("2d");if(!o)return;o.drawImage(t,0,0);let n=o.getImageData(0,0,e.width,e.height),r=n.data;for(let e=0;e<r.length;e+=4){let t=r[e],o=r[e+1],n=r[e+2];t>250&&o>250&&n>250&&(r[e+3]=0)}o.putImageData(n,0,0);let a=e.toDataURL("image/png"),i={id:Date.now().toString(),type:"signature",x:j.x,y:j.y,width:200,height:100,pageNumber:x,imageData:a};console.log("Creating signature annotation:",i),b(e=>{let t=[...e,i];return console.log("Annotations after adding signature:",t),t}),N(!1),S(null),w("select"),ek.current&&ek.current.clear()},className:"flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"Add Signature"})]})]})}),em&&(0,n.jsx)("div",{className:"fixed inset-0 flex items-center justify-center",style:{zIndex:99999,backgroundColor:"rgba(0, 0, 0, 0.3)"},children:(0,n.jsxs)("div",{className:"bg-white rounded-xl p-6 w-full mx-4 shadow-2xl border border-gray-300",style:{maxWidth:"500px"},children:[(0,n.jsx)("h3",{className:"text-lg font-semibold mb-4 text-gray-800",children:"Download PDF"}),(0,n.jsxs)("div",{className:"mb-4",children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"File name:"}),(0,n.jsx)("input",{type:"text",value:ey,onChange:e=>ew(e.target.value),className:"w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 text-base font-medium text-gray-900",placeholder:"Enter filename...",autoFocus:!0,spellCheck:!1,onKeyPress:e=>{"Enter"===e.key&&eE()}}),(0,n.jsx)("p",{className:"mt-2 text-xs text-gray-500",children:"Your file will be saved to your default Downloads folder"})]}),(0,n.jsxs)("div",{className:"flex gap-3",children:[(0,n.jsx)("button",{onClick:()=>eb(!1),className:"flex-1 px-4 py-2.5 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 font-medium transition-all",children:"Cancel"}),(0,n.jsx)("button",{onClick:eE,className:"flex-1 px-4 py-2.5 bg-gradient-to-r from-indigo-600 to-purple-600 text-white rounded-lg hover:from-indigo-700 hover:to-purple-700 font-medium shadow-lg transition-all",children:"Download"})]})]})})]})}}}]);